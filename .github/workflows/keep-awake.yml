name: Keep Render Apps Alive

on:
  schedule:
    - cron: '*/10 * * * *'  # æ¯10åˆ†é’Ÿï¼ˆç¬¦åˆå…è´¹è®¡åˆ’é™åˆ¶ï¼‰
  workflow_dispatch:

env:
  RENDER_APPS: |
    https://basketball-match-1.onrender.com
    https://score-ahze.onrender.com

jobs:
  keep-alive:
    runs-on: ubuntu-latest
    timeout-minutes: 5  # è®¾ç½®è¶…æ—¶æ—¶é—´
    
    steps:
      - name: ğŸš€ å¯åŠ¨ä¿æ´»ä»»åŠ¡
        run: |
          echo "å¼€å§‹æ—¶é—´: $(date)"
          echo "GitHub Actions Runner IP: $(curl -s ifconfig.me)"
          echo "========================================"
          
          # è¯»å–åº”ç”¨åˆ—è¡¨
          IFS=$'\n' read -d '' -ra apps <<< "$RENDER_APPS"
          
          for app in "${apps[@]}"; do
            if [ -n "$app" ]; then
              echo "ğŸŒ è®¿é—®: $app"
              
              # ç¬¬ä¸€æ¬¡è®¿é—®ï¼ˆå¤„ç†å†·å¯åŠ¨ï¼‰
              echo "  ç¬¬ä¸€æ¬¡è¯·æ±‚ï¼ˆå†·å¯åŠ¨å¯èƒ½è¾ƒæ…¢ï¼‰..."
              time_1=$(curl -f -s -o /dev/null -w "%{time_total}" --max-time 60 "$app" 2>/dev/null || echo "timeout")
              
              sleep 3  # ç­‰å¾…åº”ç”¨å®Œå…¨å¯åŠ¨
              
              # ç¬¬äºŒæ¬¡è®¿é—®ï¼ˆæ­£å¸¸å“åº”ï¼‰
              echo "  ç¬¬äºŒæ¬¡è¯·æ±‚ï¼ˆé¢„çƒ­åï¼‰..."
              time_2=$(curl -f -s -o /dev/null -w "%{time_total}" --max-time 30 "$app" 2>/dev/null || echo "timeout")
              
              echo "  å“åº”æ—¶é—´: é¦–æ¬¡=${time_1}s, é¢„çƒ­=${time_2}s"
              echo "  âœ… å®Œæˆ"
              echo "---"
            fi
          done
          
          echo "========================================"
          echo "ç»“æŸæ—¶é—´: $(date)"
          echo "ğŸ‰ æ‰€æœ‰ Render åº”ç”¨ä¿æ´»ä»»åŠ¡å®Œæˆ"
